{{#if isLoggedIn}}
    {{> header_logged}}
{{else}}
    {{> header}}
{{/if}}
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<div class="blur-left cards-container" style="margin: 0px 300px 0px 300px;">
    <div class="cards-top">
        {{#if isLoggedIn}}
        <button onclick = "togglePopup()">Add Post</button>
        {{/if}}
        <div class="description-post"><strong>POSTS</strong></div>
        <form name="main-login-form" action="/api/post/getPost" method="GET">
            <div style="display:flex; gap:10px">
                <div class="search-post">
                    <input type="text" class="search-bar" name="query"></div>
                <div class="custom-select">
                    <select name="tags">
                        <option>All</option>
                        <option>Genshin Impact</option>
                        <option>Honkai Star Rail</option>
                        <option>Honkai Impact</option>
                        <option>Zenless Zone Zero</option>
                        <option>Mihoyo</option>
                    </select>
                    <select name="sort">
                        <option value="p_date">Newest</option>
                        <option value="upvotes">Hottest</option>
                    </select>
                </div>
                <input type="submit">
            </div>
        </form>
    </div>


    {{#each postdetails}}
    <div class="cards">
        <div style="display: flex; justify-content: space-between;">
            <span class="title-post"><strong>{{p_title}}</strong></span>
        </div>
        <span class="user-post">{{p_u_OID.u_username}}</span>
        <div class="date-post"><strong>{{p_date}}</strong></div>
        <div class="description-post">{{p_body}}<br><br></div>
        <div class="tags"><button style="margin-right:10px;">{{p_tags}}</button></div>
        <div class="img-div-post"><img src="/{{p_image.p_filepath}}" class="img-post"></div>
        <br>
        {{#if isLoggedIn}}
        <input type="button" onclick="navigateToPostPageLogged('{{_id}}')" value="See More">
        {{else}}
        <input type="button" onclick="navigateToPostPage('{{_id}}')" value="See More">
        {{/if}}
            <i class="fa-solid fa-thumbs-up upvote-icon"></i>
            <span class="downvote-count">{{upvotes}}</span>
            <i class="fa-solid fa-thumbs-down downvote-icon"></i>
            <span class="upvote-count">{{downvotes}}</span>        
    </div>
    {{/each}}


<div class = "popup" id = "popup_js">
    <div class="for-center-create">
        <div class="blur-left post-form-container">
            <h1><strong>Create Post</strong></h1>
            <form class="create-post-form" name="create-post-form" action="/api/post/createPost" method="POST" enctype="multipart/form-data">
                <div class = "close-btn" onclick="hidePopup()">&times;</div>
                <label>Title</label>
                <input type="text" placeholder="Enter Title" class="create-select-tag" style="width:50%" name="title">
                <label>Tag</label>
                    <select style="width:50%" name="tags">
                        <option>Genshin Impact</option>
                        <option>Honkai Star Rail</option>
                        <option>Honkai Impact</option>
                        <option>Zenless Zone Zero</option>
                        <option>Mihoyo</option>
                    </select>
                <label>Content</label>
                <input type="hidden" name="id" value="66776c6fb5909970e7f38836"> <!-- this is hardcoded for now sir said since ala pa sessions -->
                <textarea class="create-post-textarea" name="body"></textarea>
                <input type="file" style="width:50%" name="image">
                <input type="submit" value="submit">
            </form>
        </div>
    </div>
</div>
<script src="/common/modal.js"></script>

<script>
function navigateToPostPage(id) {
    const url = `/api/post/getPost/${id}`;
    window.location.href = url;
}
function navigateToPostPageLogged(id) {
    const url = `/api/post/getPost/${id}?isLoggedIn=true`;
    window.location.href = url;
}



</script>